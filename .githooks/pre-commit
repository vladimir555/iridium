#!/bin/bash
# Always update version before committing

REPO_ROOT=$(git rev-parse --show-toplevel)
"$REPO_ROOT/shell/update-version.sh"

# Функция для очистки пробелов в файлах определённых типов
clean_whitespace() {
    # Поддерживаемые расширения (добавь нужные)
    git diff --cached --name-only --diff-filter=ACM | \
    grep -E '\.(c|cpp|h|hpp|js|ts|py|java|html|css|sh|md|txt|go|rs|php|rb|scala)$' | \
    while read file; do
        if [ -f "$file" ]; then
            # Удаляем концевые пробелы и строки, состоящие только из пробелов/табов
            sed -i.bak -E \
                -e 's/[[:space:]]+$//' \
                -e 's/^[[:space:]]+$//' \
                "$file"
            # Удаляем временный .bak файл (если не нужен)
            rm -f "$file.bak"
            # Добавляем исправленный файл в индекс
            git add "$file"
        fi
    done
}

# Выполняем очистку
clean_whitespace
